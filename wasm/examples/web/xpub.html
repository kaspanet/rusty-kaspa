<html>
    <head>
        <script type="module">
            import * as kaspa from '../../web/kaspa/kaspa.js';
            let {PublicKeyGenerator, createAddress, NetworkType, Mnemonic, XPrv, PrivateKeyGenerator } = kaspa;
            window.XPublicKey = PublicKeyGenerator;
            (async () => {
                // const wasm = await kaspa.default('./kaspa/kaspa_wasm_bg.wasm');
                await kaspa.default('../../web/kaspa/kaspa_bg.wasm');

                console.log("kaspa", kaspa);
                console.log("version", kaspa.version());
                tests();
            })();

            async function tests(){
                const phrase = new Mnemonic("envelope flavor wood mango grass debate ritual champion direct drop front submit")
                console.log("phrase: ", phrase.phrase)
                let seed = phrase.toSeed();

                const derivationPath = "m/44'/972'/0'/0/0"; // m/44'/972'/0'/0/0

                const xPrvMaster = new XPrv(seed)
                const xPrvDerived = xPrvMaster.derivePath(derivationPath);

                const xPrv = new PrivateKeyGenerator(xPrvDerived, false, BigInt(0));
                const changeKey0 = xPrv.changeKey(0);
                const privKey0 = changeKey0.toKeypair().privateKey.toString();
                const pubKey0 = changeKey0.toKeypair().publicKey.toString();
                const address0 = changeKey0.toAddress(NetworkType.Devnet).toString();
                console.log("privKey 0", privKey0)
                console.log("pubKey 0", pubKey0)
                console.log("address 0", address0)

                // // HD Wallet-style public key generation
                // let xpub = await PublicKeyGenerator.fromMasterXPrv(
                //     xPrv,
                //     false,
                //     0n
                // );

                // console.log("xpub", xpub)
                // let xpub_str = xpub.toString();
                // console.log("xpub", xpub_str)

                // // Generates the first 10 Receive Public keys and their addresses
                // let compressedPublicKeys = await xpub.receivePubkeys(0, 10);
                // console.log("receive address compressedPublicKeys", compressedPublicKeys);
                // let addresses1 = compressedPublicKeys.map(key => createAddress(key, NetworkType.Mainnet).toString());
                // console.log("receive addresses", addresses1);

                // xpub = await PublicKeyGenerator.fromString(xpub_str);

                // // Generates the first 10 Receive Public keys and their addresses
                // compressedPublicKeys = await xpub.receivePubkeys(0, 10);
                // console.log("receive address compressedPublicKeys", compressedPublicKeys);
                // let addresses2 = compressedPublicKeys.map(key => createAddress(key, NetworkType.Mainnet).toString());
                // console.log("receive addresses", addresses2);
                // //addresses1[0] += "should fail";
                // if (!addresses2.length){
                //     throw new Error("Address creation failed")
                // }else if (addresses2.find((address, index)=>addresses1[index]!=address)){
                //     console.error("Xpub restore failed");
                // }else{
                //     console.info("Xpub restore success");
                // }

            }
        </script>
    </head>
    <body></body>
</html>