# RustBridge Multi-Instance Configuration Example
# This file demonstrates the new multi-instance feature
# All instances share the same Kaspa node (kaspad_address)
# Each instance can have its own stratum_port, min_share_diff, prom_port, and log settings

# ============================================
# GLOBAL SETTINGS (shared by all instances)
# ============================================

# Kaspa node gRPC address (SHARED - all instances use the same node)
# Format: "HOST:PORT" or "grpc://HOST:PORT"
# Default HTTP gRPC port is typically 16110
kaspad_address: "127.0.0.1:16110"

# Block template wait time in milliseconds (shared)
# How long to wait between checking for new block templates
block_wait_time: 1000

# Print statistics to console (shared)
print_stats: true

# Default log to file setting (can be overridden per-instance)
log_to_file: true

# Health check server port (optional, leave empty to disable)
# This is a GLOBAL health check endpoint
health_check_port: ""

# Variable difficulty settings (defaults, can be overridden per-instance)
var_diff: false
shares_per_min: 20
var_diff_stats: false

# Power-of-2 difficulty clamping (default, can be overridden per-instance)
pow2_clamp: true

# Extranonce size (auto-detected per client, this is just for backward compatibility)
extranonce_size: 2

# ============================================
# INSTANCE CONFIGURATIONS
# ============================================
# Each instance runs independently with its own:
# - Stratum port (REQUIRED, must be unique)
# - Minimum share difficulty (REQUIRED)
# - Prometheus port (OPTIONAL, per-instance)
# - Log to file (OPTIONAL, per-instance, defaults to global setting)
# - Other settings (OPTIONAL, per-instance overrides)

instances:
  # Instance 1: Low difficulty pool (for smaller miners)
  - stratum_port: ":5555"
    min_share_diff: 512
    prom_port: ":2114"
    log_to_file: true
    # Optional: instance-specific overrides
    # var_diff: false
    # pow2_clamp: true

  # Instance 2: Medium difficulty pool
  - stratum_port: ":5556"
    min_share_diff: 4096
    prom_port: ":2115"
    log_to_file: true

  # Instance 3: High difficulty pool (for powerful miners)
  - stratum_port: ":5557"
    min_share_diff: 8192
    prom_port: ":2116"
    log_to_file: false  # This instance won't log to file

  # Instance 4: Custom difficulty with instance-specific settings
  - stratum_port: ":5558"
    min_share_diff: 16384
    prom_port: ":2117"
    log_to_file: true
    var_diff: true  # Override global var_diff for this instance
    shares_per_min: 30  # Override global shares_per_min for this instance

# ============================================
# NOTES
# ============================================
# - All instances connect to the same kaspad_address
# - Each instance has isolated ShareHandler and ClientHandler
# - Each instance can have its own Prometheus metrics endpoint
# - Each instance can have its own log file (if log_to_file is true)
# - Instance-specific settings override global defaults
# - stratum_port must be unique across all instances
# - prom_port should be unique if specified (to avoid conflicts)

